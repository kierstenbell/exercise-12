---
title: "exercise-12"
output: html_document
date: "2024-04-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Preliminaries
- Using the {tidyverse} read_tsv() function, load the “Mammal_lifehistories_v2.txt” dataset from this [URL](https://raw.githubusercontent.com/difiore/ada-2024-datasets/main/Mammal_lifehistories_v2.txt) as a “tibble” named d. As discussed in class, this is dataset that compiles life history and other variables for over 1400 species of placental mammals from 17 different Orders.
- Do a bit of exploratory data analysis with this dataset, e.g., using the {skimr} package. Which of the variables are categorical and which are numeric?

    - Categorical variables: order, family, Genus, and species
    - Numeric variables: mass(g), gestation(mo), newborn(g), weaning(mo), wean mass(g), AFR(mo) max.life(mo), litter size, litters/year, refs

```{r cars}
# Load libraries 
library(skimr)
library(tidyverse)
library(naniar)

# Grab file
f <- "https://raw.githubusercontent.com/difiore/ada-2024-datasets/main/Mammal_lifehistories_v2.txt"
d <- read_tsv(f, col_names = TRUE)
skim (d)
head(d)

```
#### Step 1 
- Replace all values of -999 (the authors’ code for missing data) with NA.

```{r}
# use replace_with_na_all() function from the {naniar} to replace -999 with NA.
d <- replace_with_na_all(data = d, condition = ~.x == -999.00)

```

#### Step 2 
- Drop the variables **litter size** and **refs**.

```{r}
d <- d %>%
  select(-c(`litter size`, refs))

# double check 
glimpse(d) # litter size and refs are dropped 
```

#### Step 3
- Log transform all of the other numeric variables

```{r}
# The mutate(across(where(is.numeric))) looks for variables that are numeric and log transforms. NOTE. Variable names DO NOT CHANGE. 
d <- d %>% 
  mutate(across(where(is.numeric), ~log(.)))

head(d)
```


#### Step 4 
- Regress the (now log transformed) age [gestation(mo), weaning(mo), AFR(mo) (age at first reproduction), and max. life(mo) (maximum lifespan)] and mass [newborn(g) and wean mass(g)] variables on (now log transformed) overall body mass(g) and add the residuals to the dataframe as new variables (relGest, relWean, relAFR, relLife, relNewbornMass, and relWeaningMass).
```{r}
# Regress the selected variables on log transformed body mass, called mass(g)
# Must include na.action = na.include in order to include NA to make sure the matrix fits 
m1 <- lm(`gestation(mo)` ~ `mass(g)`, data = d, na.action = na.exclude)
m2 <- lm(`weaning(mo)` ~ `mass(g)`, data = d, na.action = na.exclude)
m3 <- lm(`AFR(mo)` ~ `mass(g)`, data = d, na.action = na.exclude)
m4 <- lm(`max. life(mo)` ~ `mass(g)`, data = d, na.action = na.exclude)
m5 <- lm(`newborn(g)` ~ `mass(g)`, data = d, na.action = na.exclude)
m6 <- lm(`wean mass(g)` ~ `mass(g)`, data = d,  na.action = na.exclude)


# Need to call resid(). Doing m1$residuals did not include NA...
d <- d %>%
  mutate(
    relGest = resid(m1),
    relWean = resid(m2), 
    relAFR = resid(m3),
    relLife = resid(m4),
    relNewbornMass = resid(m5), 
    relWeaningMass = resid(m6)
  )

```

#### Step 5
- Plot residuals of max lifespan (relLife) in relation to Order. Which mammalian orders have the highest residual lifespan?

    - Based on maximum values, the mammalian orders with the highest residual lifespan: (1) primates, (2) rodentia, and (3) xenarthra
    - Based on median values, the mammalian orders with the highest residual lifespan: (1) primates, (2) pholidota, and (3) Scandentia
    
- Plot residuals of newborn mass (relNewbornMass) in relation to Order. Which mammalian orders have the have highest residual newborn mass?

    - Based on maximum values, the mammalian orders with the highest residual newborn mass: (1) cetacea, (2) carnivora, (3) artiodactyla
    - Based on median values, the mammalian orders with the highest residual newborn mass: (1) macroscelidea, (2) cetacea, (3) Hhracoidea
    
- Plot residuals of weaning mass (relWeaningMass) in relation to Order. Which mammalian orders have the have highest relative weaning mass?

    - Based on maximum values, mammalian orders with the highest relative weaning mass: (1) carnivora, (2) perissodactyla, (3) cetacea
    - Based on median values, the mammalian orders with the highest relative weaning mass: (1) perissodactyla, (2) insectivora, (3) cetacea
    
```{r}
# Plot: Residuals of max lifespan (relLife) in relation to Order
p_relLife <- ggplot(data = d, aes(x = order, y = relLife)) + 
  geom_boxplot() + 
  geom_jitter(alpha = 0.05) + # makes the dots more transparent 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  xlab("Order") + ylab("Residual Log(Max Lifespan)")
p_relLife

# To double check: max lifespan::order; use R's 5 number summary function fivenum() to definitively tell which orders have the highest max
relLife_5NumSum <- d %>%
  group_by(order) %>%
  summarise(n = n(),
            min = fivenum(relLife)[1],
            Q1 = fivenum(relLife)[2],
            median = fivenum(relLife)[3],
            Q3 = fivenum(relLife)[4],
            max = fivenum(relLife)[5])
relLife_5NumSum

# Plot: Residuals of newborn mass (relNewbornMass) in relation to Order
p_relNewbornMass <- ggplot(data = d, aes(x = order, y = relNewbornMass)) + 
  geom_boxplot() + 
  geom_jitter(alpha = 0.05) + # makes the dots more transparent 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  xlab("Order") + ylab("Residual Log(Newborn Mass (g)")
p_relNewbornMass

# It is difficult to tell what some of the maxes were on the graph, so using R's 5 number summary function fivenum() to definitively tell which orders have the highest max
relNewbornMass_5NumSum <- d %>%
  group_by(order) %>%
  summarise(n = n(),
            min = fivenum(relNewbornMass)[1],
            Q1 = fivenum(relNewbornMass)[2],
            median = fivenum(relNewbornMass)[3],
            Q3 = fivenum(relNewbornMass)[4],
            max = fivenum(relNewbornMass)[5])
relNewbornMass_5NumSum

# Plot: Residuals of weaning mass (relWeaningMass) in relation to Order
p_relWeaningMass <- ggplot(data = d, aes(x = order, y = relWeaningMass)) + 
  geom_boxplot() + 
  geom_jitter(alpha = 0.05) + # makes the dots more transparent 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  xlab("Order") + ylab("Residual Log(Weaning Mass (g))")
p_relWeaningMass

# To double check plots 
relWeaningMass_5NumSum <- d %>%
  group_by(order) %>%
  summarise(n = n(),
            min = fivenum(relWeaningMass)[1],
            Q1 = fivenum(relWeaningMass)[2],
            median = fivenum(relWeaningMass)[3],
            Q3 = fivenum(relWeaningMass)[4],
            max = fivenum(relWeaningMass)[5])
relWeaningMass_5NumSum
```

#### Step 6
- Run models and a model selection process to evaluate what (now log transformed) variables best predict each of the two response variables, max. life(mo) and AFR(mo), from the set of the following predictors: gestation(mo), newborn(g), weaning(mo), wean mass(g), litters/year, and overall body mass(g).
- What variables, if any, appear in all of this set of “top” models?
- Calculate and plot the model-averaged coefficients and their CIs across this set of top models.el selection process to evaluate what (now log transformed) variables best predict each of the two response variables, max. life(mo) and AFR(mo), from the set of the following predictors: gestation(mo), newborn(g), weaning(mo), wean mass(g), litters/year, and overall body mass(g).

```{r}


```


